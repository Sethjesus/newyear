<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- æ‰‹æ©Ÿå‹å–„ï¼šåŠŸèƒ½å…¨é¡¯ç¤ºï¼æ‹œå¹´ï¼‹æ“²ç­Šï¼‹3Då»Ÿå®‡ï¼‹éŸ³æ¨‚ï¼Œé€šé€šéƒ½è¦ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes, viewport-fit=cover">
    <title>Jacky æ‹œå¹´ Â· é¦¬å¹´æ“²ç­Š Â· 3Då»Ÿå®‡</title>
    <style>
        /* ********** å–œæ°£æ´‹æ´‹ Â· åŠŸèƒ½å…¨é–‹ ********** */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #7d2a1a;
            background: linear-gradient(145deg, #9f3e1f, #6a1c0a);
            font-family: "Noto Serif TC", "æ¨™æ¥·é«”", "DFKai-SB", "PingFang TC", "Helvetica Neue", sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff7e6;
            text-shadow: 3px 3px 0 #4f1e0c;
        }

        /* ------------- å¤§ç´…åŒ… Â· æ‹œå¹´ä¸»è¦–è¦º ------------- */
        .red-envelope {
            background: #c44123;
            background-image: radial-gradient(circle at 25% 35%, #ff8a5c 2px, transparent 3px);
            background-size: 22px 22px;
            max-width: 650px;
            width: 100%;
            border-radius: 45px 45px 25px 25px;
            border: 10px solid #ffce80;
            box-shadow: 0 25px 35px rgba(0,0,0,0.6);
            padding: 40px 28px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 5px auto 20px;
        }

        .red-envelope::before {
            content: "ğŸ´ ä¸™åˆå¹´ Â· é¦¬å¹´å¤§å‰ ğŸ´";
            position: absolute;
            top: -6px;
            left: 12%;
            width: 76%;
            background: #ffeaa6;
            color: #952f1a;
            font-size: min(26px, 6.5vw);
            font-weight: 900;
            text-align: center;
            padding: 10px 0;
            border-radius: 60px;
            border: 4px solid #ffcc44;
            box-shadow: 0 7px 0 #9e6a3a;
            letter-spacing: 6px;
            text-shadow: none;
        }

        .jacky-signature {
            font-size: min(50px, 13vw);
            font-weight: 900;
            color: #ffefb5;
            text-shadow: 7px 7px 0 #601f0e;
            margin-top: 35px;
            margin-bottom: 5px;
            letter-spacing: 12px;
            border-bottom: 4px dashed #ffcc77;
            padding-bottom: 12px;
        }

        .horse-icon {
            font-size: min(80px, 20vw);
            margin: 5px 0;
            filter: drop-shadow(8px 8px 0 #401a0a);
        }

        .big-greeting {
            font-size: min(64px, 16vw);
            font-weight: 900;
            color: #ffe982;
            text-shadow: 6px 6px 0 #942b12;
            text-align: center;
            line-height: 1.2;
            margin: 10px 0;
        }

        .bless-panel {
            background: #fff3da;
            border-radius: 70px 70px 35px 35px;
            padding: 35px 25px;
            width: 100%;
            color: #402010;
            text-shadow: none;
            font-weight: 700;
            margin: 30px 0 20px;
            border: 6px solid #ffb347;
            box-shadow: inset 0 -8px 0 #b87d3e, inset 0 4px 15px #fff3bf;
        }

        .bless-title {
            font-size: min(38px, 9vw);
            font-weight: 800;
            color: #a14323;
            text-align: center;
            letter-spacing: 5px;
            margin-bottom: 15px;
        }

        .bless-content {
            font-size: min(44px, 10vw);
            font-weight: 900;
            color: #c53d1c;
            background: #ffeeb5;
            padding: 18px 12px;
            border-radius: 60px;
            text-align: center;
            border: 4px solid #ff9420;
            word-break: break-word;
            line-height: 1.4;
        }

        .from-name {
            font-size: min(34px, 8vw);
            background: #7e3f22;
            color: #fffad6;
            padding: 14px 40px;
            border-radius: 60px;
            border: 4px solid #ffc56a;
            margin: 25px 0 10px;
            font-weight: bold;
            letter-spacing: 8px;
        }

        .gold-bottom {
            background: #c4592a;
            width: 100%;
            border-radius: 50px;
            padding: 22px;
            margin-top: 15px;
            border: 5px solid #ffcd70;
        }

        /* ------------- åŠŸèƒ½å€ï¼šé€šé€šé¡¯ç¤ºï¼ç†±é¬§æ“²ç­Šï¼ ------------- */
        .function-area {
            max-width: 650px;
            width: 100%;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* æ“²ç­Šé¢æ¿ */
        .divination-box {
            background: rgba(40, 22, 8, 0.98);
            backdrop-filter: blur(12px);
            border: 6px solid #edb15c;
            border-radius: 60px 60px 30px 30px;
            padding: 25px 20px;
            color: #fff0c0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 50px rgba(255, 140, 0, 0.8);
            border-top: 12px solid #ffcc66;
        }

        .jacky-sign {
            font-size: min(32px, 7vw);
            background: #b3763e;
            padding: 12px 30px;
            border-radius: 60px;
            color: #fffad6;
            letter-spacing: 0.3em;
            font-weight: 900;
            border: 4px solid #ffdcaa;
            text-shadow: 2px 2px 0 #5e301a;
            width: 100%;
            text-align: center;
        }

        .moon-icons {
            font-size: min(110px, 22vw);
            line-height: 1.2;
            filter: drop-shadow(0 0 30px #ffbb33);
            background: #2f1e12;
            padding: 15px 40px;
            border-radius: 120px;
            border: 6px solid #ffcc55;
            transition: transform 0.1s;
        }

        .shake-animation {
            animation: shakeHard 0.4s cubic-bezier(0.25, 0.1, 0.25, 1) !important;
        }

        @keyframes shakeHard {
            0% { transform: rotate(0deg); }
            20% { transform: rotate(35deg); }
            40% { transform: rotate(-35deg); }
            60% { transform: rotate(25deg); }
            80% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }

        .result-card {
            font-size: min(30px, 7vw);
            background: #4f2c1a;
            padding: 22px 18px;
            border-radius: 50px;
            text-align: center;
            color: #ffefb0;
            border: 5px solid #ffbb44;
            min-height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            font-weight: 700;
            word-break: break-word;
            box-shadow: inset 0 0 20px #704d25;
        }

        /* æ–æ™ƒæç¤º */
        .shake-hint {
            background: rgba(255, 215, 0, 0.95);
            color: #2d1706;
            font-size: min(36px, 8vw);
            font-weight: 900;
            padding: 15px 30px;
            border-radius: 70px;
            border: 6px solid #ffaa22;
            box-shadow: 0 0 60px #ffaa00;
            text-align: center;
            letter-spacing: 8px;
            animation: pulseHint 1.2s infinite alternate;
        }

        @keyframes pulseHint {
            from { transform: scale(1); background: #ffcc22; }
            to { transform: scale(1.05); background: #ffb422; }
        }

        /* éŸ³æ¨‚æ§åˆ¶ */
        .music-control {
            background: rgba(10,5,2,0.9);
            backdrop-filter: blur(12px);
            border: 4px solid #ffaa33;
            border-radius: 80px;
            padding: 15px 25px;
            color: white;
            font-size: min(32px, 7vw);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 0 35px #ff9900;
        }

        .music-btn {
            background: #ffaa33;
            border: none;
            color: #2d1706;
            font-size: min(34px, 7vw);
            font-weight: bold;
            cursor: pointer;
            padding: 10px 25px;
            border-radius: 60px;
            border-bottom: 6px solid #8b5a2b;
            transition: 0.05s;
        }

        .music-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        /* 3Då»Ÿå®‡å®¹å™¨ */
        .temple-container {
            width: 100%;
            max-width: 650px;
            height: 280px;
            border-radius: 40px;
            overflow: hidden;
            border: 6px solid #ffbb44;
            box-shadow: 0 0 40px #ff8800;
            margin: 10px auto;
            background: #22100c;
        }

        #templeCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .section-title {
            font-size: min(28px, 6vw);
            color: #ffefb0;
            text-align: left;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #73200c;
            letter-spacing: 4px;
        }

        .footer-note {
            color: #ffdfaa;
            font-size: min(24px, 6vw);
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            width: 100%;
            text-shadow: 2px 2px 0 #401a0a;
        }
    </style>
</head>
<body>

    <!-- 
        ########################################################
        #          åŠŸ èƒ½ å…¨ é¡¯ ç¤º ï¼ æ‹œ å¹´ æ“² ç­Š 3D éŸ³ æ¨‚      #
        #          æ– æ‰‹ æ©Ÿ é¦¬ ä¸Š æ“² ç­Š ï¼Œ ç†± ç†± é¬§ é¬§         #
        #          Jacky ç¥ æ‚¨ é¦¬ å¹´ è¡Œ å¤§ é‹ ï¼              #
        ########################################################
    -->

    <!-- ************ ç´”æ‹œå¹´ç´…åŒ… â€” ç¥ç¦æ»¿æ»¿ ************ -->
    <div class="red-envelope">
        <div class="jacky-signature">Jacky</div>
        <div class="horse-icon">ğŸğŸ®âœ¨</div>
        <div class="big-greeting">
            é¦¬å¹´<br>è¡Œå¤§é‹
        </div>

        <div class="bless-panel">
            <div class="bless-title">
                ğŸ§§ ä¸™åˆå¹´ å‰ç¥¥å¦‚æ„ ğŸ§§
            </div>
            <div class="bless-content">
                é¾é¦¬ç²¾ç¥ Â· è²¡æºå»£é€²<br>
                é¦¬åˆ°æˆåŠŸ Â· å¹³å®‰å¥åº·
            </div>
            <div style="font-size:min(36px,8vw); color:#9c482b; text-align:center; margin-top:25px; font-weight:800;">
                ä¸€é¦¬ç•¶å…ˆ Â· æ­¥æ­¥é«˜å‡
            </div>
        </div>

        <div class="lantern-deco" style="display: flex; justify-content: center; gap: 30px; font-size: min(48px, 12vw); margin: 15px 0 5px;">
            <span>ğŸ®</span> <span>ğŸ´</span> <span>ğŸ®</span>
        </div>
        
        <div class="from-name">
            Jacky ç¥æ‚¨
        </div>

        <div class="gold-bottom">
            <p style="font-size: min(42px, 10vw); font-weight: 900; color: #fff5c1; text-align: center; line-height: 1.5; text-shadow: 5px 5px 0 #73200c;">
                é¦¬å¹´ç™¼å¤§è²¡<br>å¥½é‹æ—ºæ—ºä¾†
            </p>
            <p style="font-size: min(30px, 7vw); color: #fffcea; text-align: center; margin-top: 20px; letter-spacing: 4px;">
                ğŸ å¹´å¹´æœ‰é¤˜ Â· æ­²æ­²å¹³å®‰ ğŸ
            </p>
        </div>
    </div>

    <!-- ************ åŠŸèƒ½å€åŸŸï¼šæ“²ç­Šé¢æ¿ ************ -->
    <div class="function-area">
        <div class="section-title">ğŸ“± æ–æ‰‹æ©Ÿ Â· æ“²ç­Šæ±‚å¥½é‹</div>
        <div class="divination-box">
            <div class="jacky-sign">Jacky æ–æ“²ç­Š Â· é¦¬å¹´è¡Œå¤§é‹</div>
            <div id="moonDisplay" class="moon-icons">ğŸ¥¢ğŸ¥¢</div>
            <div id="resultMessage" class="result-card">æ–æ™ƒæ‰‹æ©Ÿ ç«‹å³æ“²ç­Š</div>
            <div style="font-size: min(26px, 6vw); color: #ffe9ad; display: flex; align-items: center; justify-content: center; gap: 15px; background: #2f1e10; padding: 10px 25px; border-radius: 60px; border:3px solid #ffbb33;">
                <span>ğŸ“³ æ– Â· å°±æœ‰ç­Š</span> <span style="font-size:40px;">ğŸ”„</span>
            </div>
        </div>

        <!-- æ–æ™ƒæç¤º -->
        <div id="shakeHint" class="shake-hint">
            ğŸ“³ æ–æ‰‹æ©Ÿ Â· æ“²ç­Š ğŸ“³
        </div>

        <!-- éŸ³æ¨‚æ§åˆ¶ -->
        <div class="section-title">ğŸµ èƒŒæ™¯éŸ³æ¨‚ Â· é¦¬å¹´å–œæ¨‚</div>
        <div class="music-control">
            <span style="font-weight:bold; letter-spacing:4px;">ğŸ´ é¦¬å¹´ç™¼è²¡</span>
            <button id="toggleMusicBtn" class="music-btn">ğŸ”Š é—œéŸ³æ¨‚</button>
        </div>

        <!-- 3Då»Ÿå®‡ -->
        <div class="section-title">ğŸ¯ 3D é¦¬å¹´è–å»Ÿ Â· ç¥ˆç¦</div>
        <div id="templeContainer" class="temple-container">
            <canvas id="templeCanvas"></canvas>
        </div>
    </div>

    <div class="footer-note">
        ğŸ§§ æ–°æ˜¥å¤§å–œ Â· è¬äº‹å¦‚æ„ Â· Jacky æ•¬è³€ ğŸ§§
    </div>

    <!-- èƒŒæ™¯éŸ³æ¨‚ -->
    <audio id="bgMusic" loop preload="auto" style="display: none;">
        <source src="https://raw.githubusercontent.com/Sethjesus/newyear/main/horse.mp3" type="audio/mpeg">
    </audio>

    <!-- ä½¿ç”¨ Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        // ************ 3D å»Ÿå®‡ ************
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const canvas = document.getElementById('templeCanvas');
        const width = canvas.clientWidth;
        const height = canvas.clientHeight;

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x331e14);

        const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
        camera.position.set(5, 3, 10);
        camera.lookAt(0, 1, 0);

        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(width, height);
        renderer.shadowMap.enabled = true;

        // ç‡ˆå…‰
        const ambient = new THREE.AmbientLight(0x6f4e3a);
        scene.add(ambient);
        
        const light = new THREE.DirectionalLight(0xffeedd, 1);
        light.position.set(5, 8, 10);
        light.castShadow = true;
        light.receiveShadow = true;
        scene.add(light);

        // åœ°é¢
        const ground = new THREE.Mesh(
            new THREE.CircleGeometry(12, 20),
            new THREE.MeshStandardMaterial({ color: 0x6b4f3c, roughness: 0.8 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.01;
        ground.receiveShadow = true;
        scene.add(ground);

        // å»Ÿå®‡
        const base = new THREE.Mesh(
            new THREE.BoxGeometry(5.0, 0.3, 4.8),
            new THREE.MeshStandardMaterial({ color: 0x8a6b4b, roughness: 0.7 })
        );
        base.position.set(0, 0.15, 0);
        base.castShadow = true;
        base.receiveShadow = true;
        scene.add(base);

        const wall = new THREE.Mesh(
            new THREE.BoxGeometry(4.6, 1.6, 4.2),
            new THREE.MeshStandardMaterial({ color: 0xb87333, roughness: 0.6 })
        );
        wall.position.set(0, 1.0, 0);
        wall.castShadow = true;
        wall.receiveShadow = true;
        scene.add(wall);

        const roof = new THREE.Mesh(
            new THREE.ConeGeometry(3.8, 1.0, 4),
            new THREE.MeshStandardMaterial({ color: 0xcc8833, roughness: 0.5 })
        );
        roof.position.set(0, 1.95, 0);
        roof.rotation.y = Math.PI / 4;
        roof.castShadow = true;
        roof.receiveShadow = true;
        scene.add(roof);

        // ç‡ˆç± 
        const lanternMat = new THREE.MeshStandardMaterial({ color: 0xd84c3c, emissive: 0x441111, emissiveIntensity: 0.2 });
        const positions = [[-1.4, 1.6, 1.4], [1.4, 1.6, 1.4], [0, 1.8, 1.4]];
        positions.forEach(pos => {
            const lantern = new THREE.Mesh(new THREE.SphereGeometry(0.22), lanternMat);
            lantern.position.set(pos[0], pos[1], pos[2]);
            lantern.castShadow = true;
            scene.add(lantern);
        });

        // é¦™çˆ
        const burner = new THREE.Mesh(
            new THREE.CylinderGeometry(0.7, 0.8, 0.2, 16),
            new THREE.MeshStandardMaterial({ color: 0x5a4734 })
        );
        burner.position.set(0, 0.3, 0.9);
        burner.castShadow = true;
        burner.receiveShadow = true;
        scene.add(burner);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.06;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.0;
        controls.enableZoom = true;
        controls.enablePan = true;
        controls.target.set(0, 1.2, 0);

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            const w = canvas.clientWidth;
            const h = canvas.clientHeight;
            renderer.setSize(w, h);
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
        });

        // ************ æ–æ™ƒæ“²ç­Š + éŸ³æ¨‚ ************
        const fortunes = [
            { emoji: 'ğŸ¥¢ğŸ¥¢', name: 'è–ç­Š (å¤§å‰)', msg: 'ğŸ´ é¦¬å¹´å¤§ç™¼ Â· Jacky è³€' },
            { emoji: 'ğŸŒ™ğŸ¥¢', name: 'ç¬‘ç­Š (æ­¡å–œ)', msg: 'ğŸ® é¾é¦¬ç²¾ç¥ Â· æ–å‡ºå¥½é‹' },
            { emoji: 'ğŸ¥¢ğŸŒ™', name: 'é™°ç­Š (è²´äºº)', msg: 'ğŸ™ è²´äººç›¸åŠ© Â· å¹³å®‰é †é‚' },
            { emoji: 'ğŸ¥¢ğŸ¥¢', name: 'è–ç­Š (ç™¼è²¡)', msg: 'ğŸ’° é¦¬åˆ°æˆåŠŸ Â· è²¡æºæ»¾æ»¾' },
            { emoji: 'ğŸŒ™ğŸŒ™', name: 'ç¬‘ç­Š (å¦‚æ„)', msg: 'âœ¨ é‡‘é¦¬æ–ç¦ Â· Jacky è³œç¦' },
            { emoji: 'ğŸŒ™ğŸ¥¢', name: 'è–ç­Š (é›™å–œ)', msg: 'ğŸŒ¸ é¦¬å¹´å¦‚æ„ Â· å¥½äº‹æˆé›™' }
        ];

        const moonDisplay = document.getElementById('moonDisplay');
        const resultMsg = document.getElementById('resultMessage');
        const audio = document.getElementById('bgMusic');
        const toggleBtn = document.getElementById('toggleMusicBtn');
        let isPlaying = false;

        // éŸ³æ¨‚æ’­æ”¾
        audio.volume = 0.4;
        audio.play().then(() => {
            isPlaying = true;
            toggleBtn.textContent = 'ğŸ”Š é—œéŸ³æ¨‚';
        }).catch(() => {
            isPlaying = false;
            toggleBtn.textContent = 'ğŸ”‡ é–‹éŸ³æ¨‚';
        });

        toggleBtn.addEventListener('click', () => {
            if (isPlaying) {
                audio.pause();
                toggleBtn.textContent = 'ğŸ”‡ é–‹éŸ³æ¨‚';
            } else {
                audio.play();
                toggleBtn.textContent = 'ğŸ”Š é—œéŸ³æ¨‚';
            }
            isPlaying = !isPlaying;
        });

        // æ“²ç­ŠåŠŸèƒ½
        let lastShake = 0;
        let canShake = true;

        function throwBwa() {
            if (!canShake) return;
            canShake = false;

            moonDisplay.classList.add('shake-animation');
            setTimeout(() => {
                moonDisplay.classList.remove('shake-animation');
            }, 400);

            const idx = Math.floor(Math.random() * fortunes.length);
            const cup = fortunes[idx];
            moonDisplay.textContent = cup.emoji;
            resultMsg.innerHTML = `<span style="font-size:1.2em; font-weight:900;">${cup.name}</span><br><span style="font-size:1em;">${cup.msg}</span>`;

            if (navigator.vibrate) navigator.vibrate(45);

            setTimeout(() => {
                canShake = true;
            }, 800);
        }

        // æ–æ™ƒåµæ¸¬
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', function(event) {
                const acc = event.accelerationIncludingGravity;
                if (!acc) return;

                const now = Date.now();
                if (now - lastShake < 800) return;

                const x = Math.abs(acc.x || 0);
                const y = Math.abs(acc.y || 0);
                const z = Math.abs(acc.z || 0);

                if ((x > 9.5 || y > 9.5 || z > 9.5) && (x + y + z > 23)) {
                    lastShake = now;
                    throwBwa();
                }
            }, false);
        }

        // é»æ“Šç­Šæ¯ä¹Ÿå¯æ“²ç­Š
        moonDisplay.addEventListener('click', throwBwa);
    </script>
</body>
</html>